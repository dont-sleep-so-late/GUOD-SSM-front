"use strict";(self["webpackChunkssm"]=self["webpackChunkssm"]||[]).push([[315],{1315:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-form",{attrs:{inline:!0}},[e("el-form-item",[e("el-input",{attrs:{placeholder:"赛事名称",clearable:""},model:{value:t.searchForm.competitionName,callback:function(e){t.$set(t.searchForm,"competitionName",e)},expression:"searchForm.competitionName"}})],1),e("el-form-item",[e("el-button",{on:{click:t.getCompetitionList}},[t._v("搜索")])],1),e("el-form-item",[t.hasAuth("sys:competition:save")?e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("新增")]):t._e()],1),e("el-form-item",[e("el-popconfirm",{attrs:{title:"这是确定批量删除吗？"},on:{confirm:function(e){return t.delHandle(null)}}},[t.hasAuth("sys:competition:delete")?e("el-button",{attrs:{slot:"reference",type:"danger",disabled:t.delBtlStatus},slot:"reference"},[t._v("批量删除")]):t._e()],1)],1)],1),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark",border:"",stripe:""},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{label:"赛事名称",width:"120",prop:"name"}}),e("el-table-column",{attrs:{label:"赛事图片",width:"120",prop:"url"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.url?e("el-image",{attrs:{src:a.row.url}}):t._e()]}}])}),e("el-table-column",{attrs:{prop:"username",label:"赛事创建人"}}),e("el-table-column",{attrs:{prop:"place",label:"赛事地点"}}),e("el-table-column",{attrs:{prop:"starttime",label:"赛事开始时间"}}),e("el-table-column",{attrs:{prop:"endtime",label:"赛事结束时间"}}),e("el-table-column",{attrs:{prop:"status",label:"赛事状态"},scopedSlots:t._u([{key:"default",fn:function(a){return[0===a.row.status?e("el-tag",{attrs:{size:"small",type:"success"}},[t._v("发布")]):1===a.row.status?e("el-tag",{attrs:{size:"small",type:"danger"}},[t._v("未发布")]):e("el-tag",{attrs:{size:"small",type:"info"}},[t._v("暂存")])]}}])}),e("el-table-column",{attrs:{prop:"created",width:"200",label:"创建时间"}}),e("el-table-column",{attrs:{prop:"icon",width:"250",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.hasAuth("sys:competition:update")?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.editHandle(a.row.id)}}},[t._v("编辑")]):t._e(),t.hasAuth("sys:competition:update")?e("el-divider",{attrs:{direction:"vertical"}}):t._e(),[t.hasAuth("sys:competition:delete")?e("el-popconfirm",{attrs:{title:"这是一段内容确定删除吗？"},on:{confirm:function(e){return t.delHandle(a.row.id)}}},[e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v("删除")])],1):t._e()]]}}])})],1),e("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"current-page":t.current,"page-size":t.size,total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),e("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"600px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"editForm",attrs:{model:t.editForm,rules:t.editFormRules}},[e("el-form-item",{attrs:{label:"赛事名称",prop:"name","label-width":"120px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.editForm.name,callback:function(e){t.$set(t.editForm,"name",e)},expression:"editForm.name"}})],1),e("el-form-item",{attrs:{label:"赛事地点",prop:"place","label-width":"120px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.editForm.place,callback:function(e){t.$set(t.editForm,"place",e)},expression:"editForm.place"}})],1),e("el-form-item",{attrs:{label:"赛事开始时间","label-width":"120px"}},[e("el-date-picker",{attrs:{type:"datetime",placeholder:"选择赛事开始时间","picker-options":t.pickerOptions},model:{value:t.editForm.starttime,callback:function(e){t.$set(t.editForm,"starttime",e)},expression:"editForm.starttime"}})],1),e("el-form-item",{attrs:{label:"赛事结束时间","label-width":"120px"}},[e("el-date-picker",{attrs:{type:"datetime",placeholder:"选择赛事开始时间","picker-options":t.pickerOptions},model:{value:t.editForm.endtime,callback:function(e){t.$set(t.editForm,"endtime",e)},expression:"editForm.endtime"}})],1),e("el-form-item",{attrs:{label:"赛事介绍",prop:"description","label-width":"120px"}},[e("el-input",{attrs:{type:"textarea",rows:7,placeholder:"请输入赛事介绍",autocomplete:"off"},model:{value:t.editForm.description,callback:function(e){t.$set(t.editForm,"description",e)},expression:"editForm.description"}})],1),e("el-form-item",{attrs:{label:"状态",prop:"status","label-width":"120px"}},[e("el-radio-group",{model:{value:t.editForm.status,callback:function(e){t.$set(t.editForm,"status",e)},expression:"editForm.status"}},[e("el-radio",{attrs:{label:0}},[t._v("发布")]),e("el-radio",{attrs:{label:1}},[t._v("未发布")]),e("el-radio",{attrs:{label:2}},[t._v("暂存")])],1)],1),e("el-form-item",{attrs:{label:"赛事图片","label-width":"120px"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{"show-file-list":!1,action:"action","http-request":t.upload,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload}},[this.imgUrl?e("el-image",{staticClass:"avatar",attrs:{src:this.imgUrl}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){return t.resetForm("editForm")}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("editForm")}}},[t._v("确 定")])],1)],1)],1)},l=[],s=(a(4114),{name:"Competition",data(){return{searchForm:{},delBtlStatus:!0,total:0,size:10,current:1,dialogVisible:!1,editForm:{},tableData:[],editFormRules:{name:[{required:!0,message:"请输入赛事名称",trigger:"blur"}],place:[{required:!0,message:"请输入赛事地点",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}],description:[{required:!0,message:"请输入赛事介绍",trigger:"blur"}]},pickerOptions:{disabledDate(t){return t.getTime()<Date.now()}},multipleSelection:[],imgUrl:""}},created(){this.getCompetitionList()},methods:{toggleSelection(t){t?t.forEach((t=>{this.$refs.multipleTable.toggleRowSelection(t)})):this.$refs.multipleTable.clearSelection()},upload(t){console.log(t);const e=new FormData;e.append("file",t.file),this.$axios.post("/upload/img",e,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{this.imgUrl=t.data.data.fileUrl,console.log(this.editForm.url)}))},handleAvatarSuccess(t,e){console.log(t),console.log(e)},beforeAvatarUpload(t){const e=t.size/1024/1024<2;return e||this.$message.error("上传头像图片大小不能超过 2MB!"),e},dateFormat(t){let e=new Date(t),a=e.getFullYear(),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,l=e.getDate()<10?"0"+e.getDate():e.getDate();return a+"-"+i+"-"+l},handleSelectionChange(t){console.log("勾选"),console.log(t),this.multipleSelection=t,this.delBtlStatus=0==t.length},handleSizeChange(t){this.size=t,this.getCompetitionList()},handleCurrentChange(t){this.current=t,this.getCompetitionList()},resetForm(t){this.$refs[t].resetFields(),this.dialogVisible=!1,this.imgUrl="",this.editForm={}},handleClose(){this.imgUrl="",this.resetForm("editForm")},getCompetitionList(){this.$axios.get("/sys/competition/list",{params:{competitionName:this.searchForm.competitionName,current:this.current,size:this.size}}).then((t=>{this.tableData=t.data.data.pageData.records;for(let e=0;e<this.tableData.length;e++)this.tableData[e].starttime=this.dateFormat(this.tableData[e].starttime),this.tableData[e].endtime=this.dateFormat(this.tableData[e].endtime),this.tableData[e].created=this.dateFormat(this.tableData[e].created);this.size=t.data.data.pageData.size,this.current=t.data.data.pageData.current,this.total=t.data.data.pageData.total}))},submitForm(t){new Date(this.editForm.starttime)>=new Date(this.editForm.endtime)?this.$message({showClose:!0,message:"竞赛时间不规范",type:"error"}):this.$refs[t].validate((t=>{if(!t)return console.log("error submit!!"),!1;this.editForm.userid=sessionStorage.getItem("userId"),this.editForm.url=this.imgUrl,this.$axios.post("/sys/competition/"+(this.editForm.id?"update":"save"),this.editForm).then((t=>{this.$message({showClose:!0,message:"恭喜你，操作成功",type:"success",onClose:()=>{this.getCompetitionList()}}),this.dialogVisible=!1,this.imgUrl="",this.editForm={}}))}))},editHandle(t){this.$axios.get("/sys/competition/info/"+t).then((t=>{this.editForm=t.data.data.info,this.dialogVisible=!0,this.imgUrl=this.editForm.url}))},delHandle(t){let e=[];t?e.push(t):this.multipleSelection.forEach((t=>{e.push(t.id)})),console.log(e),this.$axios.post("/sys/competition/delete",e).then((t=>{this.$message({showClose:!0,message:"恭喜你，操作成功",type:"success",onClose:()=>{this.getCompetitionList()}})}))}}}),o=s,r=a(1656),n=(0,r.A)(o,i,l,!1,null,"31dfccb2",null),m=n.exports}}]);
//# sourceMappingURL=315.4de3ff65.js.map