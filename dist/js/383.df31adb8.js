"use strict";(self["webpackChunkssm"]=self["webpackChunkssm"]||[]).push([[383],{2383:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-form",{attrs:{inline:!0}},[e("el-form-item",[e("el-input",{attrs:{placeholder:"租借用户名",clearable:""},model:{value:t.searchForm.username,callback:function(e){t.$set(t.searchForm,"username",e)},expression:"searchForm.username"}})],1),e("el-form-item",[e("el-button",{on:{click:t.getBorrowList}},[t._v("搜索")])],1)],1),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark",border:"",stripe:""}},[e("el-table-column",{attrs:{label:"租借用户名",width:"110",prop:"username"}}),e("el-table-column",{attrs:{prop:"equipmentName",label:"租借器材",width:"110"}}),e("el-table-column",{attrs:{prop:"number",label:"数量",width:"110"}}),e("el-table-column",{attrs:{prop:"totalmoney",label:"租用总金额",width:"110"}}),e("el-table-column",{attrs:{prop:"status",label:"租借状态",width:"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[0===a.row.status?e("el-tag",{attrs:{size:"small",type:"info"}},[t._v("待审批")]):1===a.row.status?e("el-tag",{attrs:{size:"small",type:"success"}},[t._v("通过")]):2===a.row.status?e("el-tag",{attrs:{size:"small",type:"danger"}},[t._v("驳回")]):3===a.row.status?e("el-tag",{attrs:{size:"small"}},[t._v("归还")]):e("el-tag",{attrs:{size:"small",type:"success"}},[t._v("归还成功")]),0===a.row.repairsStatus?e("el-tag",{attrs:{size:"small"}},[t._v("待修复")]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"starttime",width:"200",label:"租用开始时间"}}),e("el-table-column",{attrs:{prop:"endtime",width:"200",label:"租用结束时间"}}),e("el-table-column",{attrs:{prop:"icon",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.hasAuth("sys:borrow:approve")&&0===a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.editHandle(a.row.id)}}},[t._v("审批")]):t._e(),t.hasAuth("sys:borrow:approve")&&3===a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.back(a.row.id)}}},[t._v("回收")]):t._e(),3===a.row.status?e("el-divider",{attrs:{direction:"vertical"}}):t._e(),t.hasAuth("sys:borrow:approve")&&3===a.row.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.bad(a.row.id,a.row.userid)}}},[t._v("损坏")]):t._e(),0===a.row.repairsStatus&&3===a.row.status?e("el-divider",{attrs:{direction:"vertical"}}):t._e(),t.hasAuth("sys:borrow:approve")&&0===a.row.repairsStatus?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.repair(a.row.id)}}},[t._v("修复")]):t._e()]}}])})],1),e("el-dialog",{attrs:{title:"器材审批",visible:t.dialogVisible,width:"600px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{attrs:{model:t.editForm}},[e("el-form-item",{attrs:{label:"租用数量","label-width":"100px"}},[e("el-input-number",{attrs:{disabled:"true"},model:{value:t.editForm.number,callback:function(e){t.$set(t.editForm,"number",e)},expression:"editForm.number"}})],1),e("el-form-item",{attrs:{label:"租用开始时间","label-width":"100px"}},[e("el-date-picker",{attrs:{type:"date",disabled:"true"},model:{value:t.editForm.starttime,callback:function(e){t.$set(t.editForm,"starttime",e)},expression:"editForm.starttime"}})],1),e("el-form-item",{attrs:{label:"租用结束时间","label-width":"100px"}},[e("el-date-picker",{attrs:{type:"date",disabled:"true"},model:{value:t.editForm.endtime,callback:function(e){t.$set(t.editForm,"endtime",e)},expression:"editForm.endtime"}})],1),e("el-form-item",{attrs:{label:"操作","label-width":"100px"}},[e("el-radio-group",{model:{value:t.editForm.status,callback:function(e){t.$set(t.editForm,"status",e)},expression:"editForm.status"}},[e("el-radio",{attrs:{label:1}},[t._v("通过")]),e("el-radio",{attrs:{label:2}},[t._v("驳回")])],1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){return t.resetForm()}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm()}}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"损坏",visible:t.badFlag,width:"600px","before-close":t.handleClose},on:{"update:visible":function(e){t.badFlag=e}}},[e("el-form",{attrs:{model:t.badForm}},[e("el-form-item",{attrs:{label:"赔偿金额","label-width":"100px"}},[e("el-input",{model:{value:t.badForm.price,callback:function(e){t.$set(t.badForm,"price",e)},expression:"badForm.price"}})],1),e("el-form-item",{attrs:{label:"赔偿原因","label-width":"100px"}},[e("el-input",{model:{value:t.badForm.reason,callback:function(e){t.$set(t.badForm,"reason",e)},expression:"badForm.reason"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){return t.resetForm()}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitBad()}}},[t._v("确 定")])],1)],1),e("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"current-page":t.current,"page-size":t.size,total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)},r=[],o={name:"Borrow",data(){return{searchForm:{},delBtlStatus:!0,total:0,size:10,current:1,dialogVisible:!1,editForm:{},tableData:[],badFlag:!1,badForm:{reason:"损坏器材"}}},created(){this.getBorrowList()},methods:{repair(t){this.$confirm("此操作已修复该器材, 是否继续?","修复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.post("/sys/borrow/repair/"+t).then((t=>{this.$message({type:"success",message:"修复成功!",onClose:()=>{this.getBorrowList()}})}))})).catch((()=>{this.$message({type:"info",message:"已取消修复"})}))},bad(t,e){this.badForm.borrowid=t,this.badForm.userid=e,this.badFlag=!0},submitBad(){this.$axios.post("/sys/compensate/save",this.badForm).then((t=>{this.$message({showClose:!0,message:"恭喜你，操作成功",type:"success",onClose:()=>{this.getBorrowList()}}),this.badFlag=!1}))},back(t){this.$confirm("此操作将回收该器材, 是否继续?","回收",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.post("/sys/borrow/back/"+t).then((t=>{this.$message({type:"success",message:"回收成功!",onClose:()=>{this.getBorrowList()}})}))})).catch((()=>{this.$message({type:"info",message:"已取消回收"})}))},dateFormat(t){let e=new Date(t),a=e.getFullYear(),s=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,r=e.getDate()<10?"0"+e.getDate():e.getDate();return a+"-"+s+"-"+r},handleSizeChange(t){console.log(`每页 ${t} 条`),this.size=t,this.getBorrowList()},handleCurrentChange(t){console.log(`当前页: ${t}`),this.current=t,this.getBorrowList()},resetForm(){this.dialogVisible=!1,this.badFlag=!1,this.editForm={},this.badForm={},this.badForm.reason="损坏器材"},handleClose(){this.resetForm()},getBorrowList(){this.$axios.get("/sys/borrow/list",{params:{username:this.searchForm.username,current:this.current,size:this.size}}).then((t=>{this.tableData=t.data.data.pageData.records;for(let e=0;e<this.tableData.length;e++)this.tableData[e].starttime=this.dateFormat(this.tableData[e].starttime),this.tableData[e].endtime=this.dateFormat(this.tableData[e].endtime);this.size=t.data.data.pageData.size,this.current=t.data.data.pageData.current,this.total=t.data.data.pageData.total}))},submitForm(){0!==this.editForm.status?this.$axios.post("/sys/borrow/passOrNotPass",this.editForm).then((t=>{this.$message({showClose:!0,message:"恭喜你，操作成功",type:"success",onClose:()=>{this.getBorrowList()}}),this.dialogVisible=!1})):this.$message({showClose:!0,message:"请选择审批操作",type:"error"})},editHandle(t){this.$axios.get("/sys/borrow/info/"+t).then((t=>{this.editForm=t.data.data.info,this.dialogVisible=!0}))}}},i=o,l=a(1656),n=(0,l.A)(i,s,r,!1,null,"d03519d8",null),d=n.exports}}]);
//# sourceMappingURL=383.df31adb8.js.map